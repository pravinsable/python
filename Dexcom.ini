; DexcomWidget - Command Output Demo
;mkdir C:\Users\sablep\OneDrive - FM Global\Documents\Rainmeter\Skins\illustro\DexcomWidget
;cd C:\Users\sablep\OneDrive - FM Global\Documents\Rainmeter\Skins\illustro\DexcomWidget>
;mklink Dexcom.ini "C:\pravin\src\github\pravinsable\python\Dexcom.ini"

[Rainmeter]
Update=300000
AccurateText=1
DynamicWindowSize=1
; Run once when the skin loads / refreshes, then refresh every 5 minutes.
OnRefreshAction=[!ZPos "2"][!CommandMeasure MeasureCmd "Run"]
OnUpdateAction=[!ZPos "2"][!CommandMeasure MeasureCmd "Run"]

[Metadata]
Name=DexcomWidget
Author=User
Version=0.3.0
Information=Runs a command and shows its output

[Variables]
Size=120
Padding=12
BodySize=22
OutputH=60
ArrowFont=Segoe UI Symbol
TextColor=235,235,235,255
MutedTextColor=190,190,190,255
; Nearly-transparent background used to keep the window size stable.
; (Prevents the skin from collapsing when DynamicWindowSize is enabled.)
BgColor=0,0,0,40
; Background colors by value range (Dexcom-style ranges).
BgLow=220,70,70,80
BgInRange=70,185,120,80
BgHigh=240,180,80,90
BgVeryHigh=235,90,70,95
; Change these two lines to run something else.
CmdProgram=python.exe
CmdParam=c:/pravin/src/github/pravinsable/python/dexcom.py

[MeterBackground]
Meter=Shape
X=0
Y=0
W=#Size#
H=#Size#
Shape=Ellipse (#Size#/2),(#Size#/2),(#Size#/2) | Fill Color #BgColor# | StrokeWidth 0
DynamicVariables=1

[MeasureCmd]
Measure=Plugin
Plugin=RunCommand
Program=#CmdProgram#
Parameter=#CmdParam#
State=Hide
OutputType=UTF8
Timeout=60000
FinishAction=[!UpdateMeasure MeasureCmd][!UpdateMeasure MeasureNumber][!UpdateMeasure MeasureValue][!UpdateMeter MeterBackground][!UpdateMeter MeterOutput][!Redraw]
UpdateDivider=-1
DynamicVariables=1

[MeasureNumber]
Measure=String
String=[MeasureCmd]
RegExpSubstitute=1
; Keep the first run of digits (e.g. "111 →" -> "111").
Substitute="^[^0-9]*([0-9]+).*$":"\1","^\s*$":"0"
DynamicVariables=1

[MeasureValue]
Measure=Calc
Formula=[MeasureNumber]
DynamicVariables=1
IfCondition=(MeasureValue < 70)
IfTrueAction=[!SetVariable BgColor #BgLow#]

IfCondition2=(MeasureValue >= 70) && (MeasureValue <= 180)
IfTrueAction2=[!SetVariable BgColor #BgInRange#]

IfCondition3=(MeasureValue > 180) && (MeasureValue <= 250)
IfTrueAction3=[!SetVariable BgColor #BgHigh#]

IfCondition4=(MeasureValue > 250)
IfTrueAction4=[!SetVariable BgColor #BgVeryHigh#]

[MeterOutput]
Meter=String
X=(#Size#/2)
Y=((#Size#-#OutputH#)/2)
W=(#Size# - (2*#Padding#))
H=#OutputH#
ClipString=2
StringAlign=Center
FontFace=#ArrowFont#
FontSize=#BodySize#
FontColor=#TextColor#
AntiAlias=1
MeasureName=MeasureCmd
Text=%1
Substitute="":"(no output yet)"
DynamicVariables=1
